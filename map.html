<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Peta: Web Mercator vs EPSG:4326 (Leaflet + Proj4Leaflet)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; padding:12px; }
    h1{font-size:18px;margin:0 0 8px}
    .wrap{display:flex;gap:12px;flex-wrap:wrap}
    .map{width:48%;min-width:320px;height:560px;border:1px solid #ddd;border-radius:8px}
    .legend{margin-top:8px}
    pre{background:#f6f6f6;padding:8px;border-radius:6px}
    @media(max-width:900px){ .map{width:100%} }
  </style>
</head>
<body>
  <h1>Peta daerah sukabumi wisata dan data jalan rusak</h1>
  <div class="wrap">
    <div id="map-mercator" class="map"></div>
    <div id="map-4326" class="map"></div>
  </div>

  <p class="legend">GeoJSON sample: Jalan Rusak & Titik Wisata di Sukabumi</p>
  <p>Petunjuk: buka file ini di browser (double-click) dan ambil screenshot kedua peta untuk perbandingan.</p>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/proj4@2.8.0/dist/proj4.js"></script>
  <script src="https://unpkg.com/proj4leaflet@1.0.2/src/proj4leaflet.js"></script>
  <script>
    // --- sample GeoJSON (Jalan Rusak Sukabumi) ---
    const jalanRusak = {
      "type": "Feature",
      "properties": { "name": "Jalan Rusak - Jl. Raya Sukabumi–Cisaat", "status": "rusak" },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [106.9281, -6.9276],
          [106.9362, -6.9230],
          [106.9445, -6.9185]
        ]
      }
    };

    // --- sample GeoJSON (Titik Wisata Sukabumi) ---
    const titikWisata = {
      "type": "FeatureCollection",
      "features": [
        {
          "type": "Feature",
          "properties": { "name": "Wisata Situ Gunung", "type": "wisata" },
          "geometry": { "type": "Point", "coordinates": [106.9097, -6.8278] }
        },
        {
          "type": "Feature",
          "properties": { "name": "Pantai Ujung Genteng", "type": "wisata" },
          "geometry": { "type": "Point", "coordinates": [106.4369, -7.3615] }
        },
        {
          "type": "Feature",
          "properties": { "name": "Geopark Ciletuh", "type": "wisata" },
          "geometry": { "type": "Point", "coordinates": [106.4716, -7.2051] }
        }
      ]
    };

    // --- Map 1: default Leaflet (Web Mercator / EPSG:3857) ---
    const mapMerc = L.map('map-mercator').setView([-6.9276, 106.9281], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(mapMerc);

    // add GeoJSON (jalan rusak)
    L.geoJSON(jalanRusak, {
      style: { color: 'red', weight: 4, dashArray: '5,5' }
    }).addTo(mapMerc).bindPopup(`<b>${jalanRusak.properties.name}</b><br/>Status: ${jalanRusak.properties.status}`);

    // add GeoJSON (titik wisata)
    L.geoJSON(titikWisata, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng, { icon: L.icon({
          iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
          iconSize: [24, 24]
        })});
      },
      onEachFeature: function (feature, layer) {
        layer.bindPopup(`<b>${feature.properties.name}</b><br/>Tipe: ${feature.properties.type}`);
      }
    }).addTo(mapMerc);

    // --- Map 2: EPSG:4326 using proj4leaflet ---
    proj4.defs("EPSG:4326", "+proj=longlat +datum=WGS84 +no_defs");
    const initialResolution = 360 / 256;
    const resolutions = [];
    for (let z = 0; z <= 19; z++) resolutions[z] = initialResolution / Math.pow(2, z);

    const crs4326 = new L.Proj.CRS('EPSG:4326', proj4.defs('EPSG:4326'), {
      origin: [-180, 90],
      resolutions: resolutions
    });

    const map4326 = L.map('map-4326', {
      crs: crs4326,
      continuousWorld: true,
      worldCopyJump: false
    }).setView([-6.9276, 106.9281], 10);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map4326);

    // add jalan rusak
    L.geoJSON(jalanRusak, {
      style: { color: 'red', weight: 4, dashArray: '5,5' }
    }).addTo(map4326).bindPopup(`<b>${jalanRusak.properties.name}</b><br/>(EPSG:4326 view)`);

    // add titik wisata
    L.geoJSON(titikWisata, {
      pointToLayer: function (feature, latlng) {
        return L.marker(latlng, { icon: L.icon({
          iconUrl: 'https://cdn-icons-png.flaticon.com/512/854/854878.png',
          iconSize: [24, 24]
        })});
      },
      onEachFeature: function (feature, layer) {
        layer.bindPopup(`<b>${feature.properties.name}</b><br/>(EPSG:4326 view)`);
      }
    }).addTo(map4326);

    // fit both maps to bounds of jalan rusak + wisata
    const allFeatures = { "type": "FeatureCollection", "features": [jalanRusak, ...titikWisata.features] };
    const bounds = L.geoJSON(allFeatures).getBounds();
    mapMerc.fitBounds(bounds);
    map4326.fitBounds(bounds);

  </script>
</body>
</html>
